/*! For license information please see 414c07798d4155c14124.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function _regeneratorValues(e){if(null!=e){var r=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(_typeof(e)+" is not iterable")}function _regenerator(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,t,o,a){var u=t&&t.prototype instanceof i?t:i,s=Object.create(u.prototype);return _regeneratorDefine2(s,"_invoke",function(n,t,o){var a,i,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(r,n){return a=r,i=0,u=e,p.n=n,c}};function m(n,t){for(i=n,u=t,r=0;!f&&s&&!o&&r<l.length;r++){var o,a=l[r],m=p.p,d=a[2];n>3?(o=d===t)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(i=0,p.v=t,p.n=a[1]):m<d&&(o=n<3||a[0]>t||t>d)&&(a[4]=n,a[5]=t,p.n=d,i=0))}if(o||n>1)return c;throw f=!0,t}return function(o,l,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&m(l,d),i=l,u=d;(r=i<2?e:u)||!f;){a||(i?i<3?(i>1&&(p.n=-1),m(i,u)):p.n=u:p.v=u);try{if(s=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(f=p.n<0)?u:n.call(t,p))!==c)break}catch(r){a=e,i=1,u=r}finally{s=1}}return{value:r,done:f}}}(n,o,a),!0),s}var c={};function i(){}function u(){}function s(){}r=Object.getPrototypeOf;var l=[][t]?r(r([][t]())):(_regeneratorDefine2(r={},t,function(){return this}),r),f=s.prototype=i.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=s,_regeneratorDefine2(f,"constructor",s),_regeneratorDefine2(s,"constructor",u),u.displayName="GeneratorFunction",_regeneratorDefine2(s,o,"GeneratorFunction"),_regeneratorDefine2(f),_regeneratorDefine2(f,o,"Generator"),_regeneratorDefine2(f,t,function(){return this}),_regeneratorDefine2(f,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:p}})()}function _regeneratorDefine2(e,r,n,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,r,n,t){function a(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?o?o(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,r,n,t)}function asyncGeneratorStep(e,r,n,t,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void n(e)}i.done?r(u):Promise.resolve(u).then(t,o)}function _asyncToGenerator(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function c(e){asyncGeneratorStep(a,t,o,c,i,"next",e)}function i(e){asyncGeneratorStep(a,t,o,c,i,"throw",e)}c(void 0)})}}import ExcelJS from"exceljs";var fileInput,run,runBottom,save,saveBottom,csvData,fileName,workbooksToSave=[],numericColumnsProcessed=[];function fileImport(){return _fileImport.apply(this,arguments)}function _fileImport(){return(_fileImport=_asyncToGenerator(_regenerator().m(function e(){var r,n,t;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(fileInput&&fileInput.files&&0!==fileInput.files.length){e.n=1;break}return alert("Seleziona almeno un file CSV"),e.a(2);case 1:run.disabled=!0,runBottom.disabled=!0,save.disabled=!0,saveBottom.disabled=!0,workbooksToSave.length=0,e.p=2,r=0;case 3:if(!(r<fileInput.files.length)){e.n=8;break}return n=fileInput.files[r],fileName=n.name,e.n=4,processCSVFile(n,fileName);case 4:return e.n=5,getNumericColumns(csvData);case 5:return numericColumnsProcessed=e.v,e.n=6,writeInExcel(csvData,fileName);case 6:return e.n=7,createExcelWorkbook(csvData,fileName);case 7:r++,e.n=3;break;case 8:workbooksToSave.length>0&&(save.disabled=!1,saveBottom.disabled=!1),run.disabled=!1,runBottom.disabled=!1,document.getElementById("fileName").textContent="",e.n=10;break;case 9:e.p=9,t=e.v,console.error("Errore durante l'importazione:",t),run.disabled=!1,runBottom.disabled=!1;case 10:return e.a(2)}},e,null,[[2,9]])}))).apply(this,arguments)}function writeInExcel(e,r){return _writeInExcel.apply(this,arguments)}function _writeInExcel(){return _writeInExcel=_asyncToGenerator(_regenerator().m(function e(r,n){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(t){var o,a,c,i,u,s;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:for(o=n.split(".")[0].substring(0,31),a=t.workbook.worksheets.add(o),c=r.length,i=r[0].length,(u=a.getRangeByIndexes(0,0,c,i)).values=r,s=0;s<i;s++)numericColumnsProcessed[s]&&(a.getRangeByIndexes(1,s,c-1,1).numberFormat=[["#,##0.00;[Red]-#,##0.00"]]);return a.getRangeByIndexes(0,0,1,i).format.font.bold=!0,u.format.autofitColumns(),u.format.autofitRows(),e.n=1,t.sync();case 1:return e.a(2)}},e)}));return function(r){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),_writeInExcel.apply(this,arguments)}function processCSVFile(e,r){return _processCSVFile.apply(this,arguments)}function _processCSVFile(){return(_processCSVFile=_asyncToGenerator(_regenerator().m(function e(r,n){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,n){var t=new FileReader;t.readAsArrayBuffer(r),t.onload=_asyncToGenerator(_regenerator().m(function r(){var o,a,c,i;return _regenerator().w(function(r){for(;;)switch(r.p=r.n){case 0:if(r.p=0,o=t.result){r.n=1;break}return e(),r.a(2);case 1:if(a=(new TextDecoder).decode(o).trim()){r.n=2;break}return e(),r.a(2);case 2:if((c=a.split(/\r?\n/).filter(function(e){return""!==e.trim()})).length){r.n=3;break}return e(),r.a(2);case 3:csvData=c.map(function(e){var r=e.replace(/"(\d+),(\d+)"/g,"$1.$2"),n=r.includes(";")?";":",";return r.split(n).map(function(e){return processCell(e)})}),e(),r.n=5;break;case 4:r.p=4,i=r.v,console.error("Errore CSV:",i),n(i);case 5:return r.a(2)}},r,null,[[0,4]])})),t.onerror=function(){n(new Error("Errore lettura file"))}}))},e)}))).apply(this,arguments)}function processCell(e){return e.trim()}function getNumericColumns(e){for(var r=e[0].length,n=Array(r).fill(!1),t=0;t<r;t++){var o=e[0][t].toString().toLowerCase();if("matricola"===o||o.includes("nr."))n[t]=!1;else{for(var a=!1,c=1;c<e.length;c++){var i=e[c][t];if(/\d+\.\d+/.test(i)){a=!0;break}}n[t]=a}}return n}function createExcelWorkbook(e,r){return _createExcelWorkbook.apply(this,arguments)}function _createExcelWorkbook(){return _createExcelWorkbook=_asyncToGenerator(_regenerator().m(function e(r,n){var t,o,a,c,i,u,s,l,f,p,m,d,y,g,v;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:for(t=new ExcelJS.Workbook,o=n.split(".")[0].substring(0,31),a=t.addWorksheet(o),c=r[0].length,i=0;i<r.length;i++)r[i].length<c?r[i].push(""):r[i].length>c&&(u=r[i].slice(0,c-1),s=r[i].slice(c-1).join(","),u.push(s),r[i]=u);for(l=[],f=0;f<c;f++)p={header:r[0][f],key:"".concat(f),width:15},numericColumnsProcessed[f]&&(p.style={numFmt:"#,##0.00;[Red]-#,##0.00"}),l.push(p);for(a.columns=l,m=1;m<r.length;m++){for(d={},y=0;y<c;y++)d["".concat(y)]=r[m][y];a.addRow(d)}return a.getRow(1).font={bold:!0},a.eachRow(function(e,r){r>1&&e.eachCell(function(e,r){numericCols[r-1]&&"number"==typeof e.value&&(e.numFmt="#,##0.00;[Red]-#,##0.00")})}),e.n=1,t.xlsx.writeBuffer();case 1:g=e.v,v=n.replace(/\.csv$/i,"")+".xlsx",workbooksToSave.push({name:v,buffer:g,numericCols:numericCols,headers:r[0]}),console.log("Workbook creato: ".concat(v));case 2:return e.a(2)}},e)})),_createExcelWorkbook.apply(this,arguments)}function updateWorkbooksFromExcel(){return _updateWorkbooksFromExcel.apply(this,arguments)}function _updateWorkbooksFromExcel(){return _updateWorkbooksFromExcel=_asyncToGenerator(_regenerator().m(function e(){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(r){var n,t,o;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return(n=r.workbook.worksheets).load("items/name"),e.n=1,r.sync();case 1:t=_regenerator().m(function e(){var t,a,c,i,u,s;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:if(t=workbooksToSave[o],a=t.name.replace(".xlsx",""),c=n.items.find(function(e){return e.name===a.substring(0,31)})){e.n=1;break}return console.warn("Worksheet ".concat(a," non trovato, salto aggiornamento")),e.a(2,1);case 1:return(i=c.getUsedRange()).load("values"),e.n=2,r.sync();case 2:return u=i.values,e.n=3,regenerateExcelBuffer(u,t.numericCols,a);case 3:s=e.v,workbooksToSave[o].buffer=s,console.log("Buffer aggiornato per: ".concat(a));case 4:return e.a(2)}},e)}),o=0;case 2:if(!(o<workbooksToSave.length)){e.n=5;break}return e.d(_regeneratorValues(t()),3);case 3:if(!e.v){e.n=4;break}return e.a(3,4);case 4:o++,e.n=2;break;case 5:return e.a(2)}},e)}));return function(r){return e.apply(this,arguments)}}());case 1:return e.a(2)}},e)})),_updateWorkbooksFromExcel.apply(this,arguments)}function regenerateExcelBuffer(e,r,n){return _regenerateExcelBuffer.apply(this,arguments)}function _regenerateExcelBuffer(){return _regenerateExcelBuffer=_asyncToGenerator(_regenerator().m(function e(r,n,t){var o,a,c,i,u,s,l,f,p;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:for(o=new ExcelJS.Workbook,a=o.addWorksheet(t),c=r[0].length,i=[],u=0;u<c;u++)s={header:r[0][u],key:"".concat(u),width:15},n[u]&&(s.style={numFmt:"#,##0.00;[Red]-#,##0.00"}),i.push(s);for(a.columns=i,l=1;l<r.length;l++){for(f={},p=0;p<c;p++)f["".concat(p)]=r[l][p];a.addRow(f)}return a.getRow(1).font={bold:!0},a.eachRow(function(e,r){r>1&&e.eachCell(function(e,r){n[r-1]&&"number"==typeof e.value&&(e.numFmt="#,##0.00;[Red]-#,##0.00")})}),e.n=1,o.xlsx.writeBuffer();case 1:return e.a(2,e.v)}},e)})),_regenerateExcelBuffer.apply(this,arguments)}function saveAllWorksheets(){return _saveAllWorksheets.apply(this,arguments)}function _saveAllWorksheets(){return _saveAllWorksheets=_asyncToGenerator(_regenerator().m(function e(){var r,n,t,o,a,c,i,u,s,l;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,updateWorkbooksFromExcel();case 1:return e.n=2,window.showDirectoryPicker();case 2:r=e.v,n=_createForOfIteratorHelper(workbooksToSave),e.p=3,n.s();case 4:if((t=n.n()).done){e.n=10;break}return o=t.value,a=o.name,c=o.buffer,e.n=5,r.getFileHandle(a,{create:!0});case 5:return i=e.v,e.n=6,i.createWritable();case 6:return u=e.v,e.n=7,u.write({type:"write",data:c});case 7:return e.n=8,u.close();case 8:document.getElementById("fileName").textContent+="".concat(a," SALVATO CON SUCCESSO,   ");case 9:e.n=4;break;case 10:e.n=12;break;case 11:e.p=11,s=e.v,n.e(s);case 12:return e.p=12,n.f(),e.f(12);case 13:return e.n=14,Excel.run(function(){var e=_asyncToGenerator(_regenerator().m(function e(r){var n,t,o,a,c;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return(n=r.workbook.worksheets).load("items/name"),e.n=1,r.sync();case 1:t=_createForOfIteratorHelper(workbooksToSave),e.p=2,a=_regenerator().m(function e(){var r,t,a;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:r=o.value,t=r.name.replace(".xlsx",""),(a=n.items.find(function(e){return e.name===t}))&&a.delete();case 1:return e.a(2)}},e)}),t.s();case 3:if((o=t.n()).done){e.n=5;break}return e.d(_regeneratorValues(a()),4);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,c=e.v,t.e(c);case 7:return e.p=7,t.f(),e.f(7);case 8:return e.n=9,r.sync();case 9:return e.a(2)}},e,null,[[2,6,7,8]])}));return function(r){return e.apply(this,arguments)}}());case 14:e.n=17;break;case 15:if(e.p=15,"AbortError"!==(l=e.v).name){e.n=16;break}alert("Salvataggio annullato"),e.n=17;break;case 16:throw l;case 17:return e.a(2)}},e,null,[[3,11,12,13],[0,15]])})),_saveAllWorksheets.apply(this,arguments)}Office.onReady(function(e){e.host===Office.HostType.Excel&&(document.getElementById("fileName").textContent="",document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",fileInput=document.getElementById("fileInput"),run=document.getElementById("run"),runBottom=document.getElementById("run-bottom"),save=document.getElementById("save"),saveBottom=document.getElementById("save-bottom"),fileInput.addEventListener("change",function(){if(fileInput.files&&fileInput.files.length>0&&(console.log("File selezionato:",fileInput.files[0].name),document.getElementById("fileName").textContent="Selected file: "+fileInput.files[0].name,fileInput.files.length>1))for(var e=1;e<fileInput.files.length;e++)document.getElementById("fileName").textContent+=", "+fileInput.files[e].name}),runBottom.addEventListener("click",fileImport),run.addEventListener("click",fileImport),save.addEventListener("click",saveAllWorksheets),saveBottom.addEventListener("click",saveAllWorksheets))});