/*! For license information please see eb9f82100d5e439521f2.js.LICENSE.txt */
function _createForOfIteratorHelper(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function _regenerator(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,t,o,a){var c=t&&t.prototype instanceof l?t:l,u=Object.create(c.prototype);return _regeneratorDefine2(u,"_invoke",function(n,t,o){var a,l,c,u=0,f=o||[],s=!1,p={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(r,n){return a=r,l=0,c=e,p.n=n,i}};function y(n,t){for(l=n,c=t,r=0;!s&&u&&!o&&r<f.length;r++){var o,a=f[r],y=p.p,g=a[2];n>3?(o=g===t)&&(c=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=n<2&&y<a[1])?(l=0,p.v=t,p.n=a[1]):y<g&&(o=n<3||a[0]>t||t>g)&&(a[4]=n,a[5]=t,p.n=g,l=0))}if(o||n>1)return i;throw s=!0,t}return function(o,f,g){if(u>1)throw TypeError("Generator is already running");for(s&&1===f&&y(f,g),l=f,c=g;(r=l<2?e:c)||!s;){a||(l?l<3?(l>1&&(p.n=-1),y(l,c)):p.n=c:p.v=c);try{if(u=2,a){if(l||(o="next"),r=a[o]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,l<2&&(l=0)}else 1===l&&(r=a.return)&&r.call(a),l<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((r=(s=p.n<0)?c:n.call(t,p))!==i)break}catch(r){a=e,l=1,c=r}finally{u=1}}return{value:r,done:s}}}(n,o,a),!0),u}var i={};function l(){}function c(){}function u(){}r=Object.getPrototypeOf;var f=[][t]?r(r([][t]())):(_regeneratorDefine2(r={},t,function(){return this}),r),s=u.prototype=l.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,_regeneratorDefine2(e,o,"GeneratorFunction")),e.prototype=Object.create(s),e}return c.prototype=u,_regeneratorDefine2(s,"constructor",u),_regeneratorDefine2(u,"constructor",c),c.displayName="GeneratorFunction",_regeneratorDefine2(u,o,"GeneratorFunction"),_regeneratorDefine2(s),_regeneratorDefine2(s,o,"Generator"),_regeneratorDefine2(s,t,function(){return this}),_regeneratorDefine2(s,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:a,m:p}})()}function _regeneratorDefine2(e,r,n,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}_regeneratorDefine2=function(e,r,n,t){function a(r,n){_regeneratorDefine2(e,r,function(e){return this._invoke(r,n,e)})}r?o?o(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},_regeneratorDefine2(e,r,n,t)}function asyncGeneratorStep(e,r,n,t,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void n(e)}l.done?r(c):Promise.resolve(c).then(t,o)}function _asyncToGenerator(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function i(e){asyncGeneratorStep(a,t,o,i,l,"next",e)}function l(e){asyncGeneratorStep(a,t,o,i,l,"throw",e)}i(void 0)})}}import ExcelJS from"exceljs";var fileInput,workbooksToSave=[];function fileImport(){return _fileImport.apply(this,arguments)}function _fileImport(){return(_fileImport=_asyncToGenerator(_regenerator().m(function e(){var r,n,t,o;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(fileInput&&fileInput.files&&0!==fileInput.files.length){e.n=1;break}return alert("Seleziona almeno un file CSV"),e.a(2);case 1:workbooksToSave.length=0,e.p=2,r=0;case 3:if(!(r<fileInput.files.length)){e.n=5;break}return n=fileInput.files[r],t=n.name,e.n=4,processCSVFile(n,t);case 4:r++,e.n=3;break;case 5:if(!(workbooksToSave.length>0)){e.n=6;break}return document.getElementById("fileName").textContent="",e.n=6,saveAllWorkbooks();case 6:e.n=8;break;case 7:e.p=7,o=e.v,console.error("Errore durante l'importazione:",o);case 8:return e.a(2)}},e,null,[[2,7]])}))).apply(this,arguments)}function processCSVFile(e,r){return _processCSVFile.apply(this,arguments)}function _processCSVFile(){return(_processCSVFile=_asyncToGenerator(_regenerator().m(function e(r,n){return _regenerator().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){var o=new FileReader;o.readAsArrayBuffer(r),o.onload=_asyncToGenerator(_regenerator().m(function r(){var a,i,l,c,u;return _regenerator().w(function(r){for(;;)switch(r.p=r.n){case 0:if(r.p=0,a=o.result){r.n=1;break}return e(),r.a(2);case 1:if(i=(new TextDecoder).decode(a).trim()){r.n=2;break}return e(),r.a(2);case 2:if((l=i.split(/\r?\n/).filter(function(e){return""!==e.trim()})).length){r.n=3;break}return e(),r.a(2);case 3:return c=l.map(function(e){var r=e.replace(/"(\d+),(\d+)"/g,"$1.$2"),n=r.includes(";")?";":",";return r.split(n).map(function(e){return processCell(e)})}),r.n=4,createExcelWorkbook(c,n);case 4:e(),r.n=6;break;case 5:r.p=5,u=r.v,console.error("Errore CSV:",u),t(u);case 6:return r.a(2)}},r,null,[[0,5]])})),o.onerror=function(){t(new Error("Errore lettura file"))}}))},e)}))).apply(this,arguments)}function processCell(e){var r=e.trim(),n=r.replace(/,/g,".");return n.includes(".")&&/\d+\.\d+/.test(n)?parseFloat(n):r}function getNumericColumns(e){for(var r=e[0].length,n=Array(r).fill(!1),t=0;t<r;t++){var o=e[0][t].toString().toLowerCase();if("matricola"===o||o.includes("nr."))n[t]=!1;else{for(var a=!1,i=1;i<e.length;i++){var l=e[i][t];if("number"==typeof l&&!Number.isInteger(l)){a=!0;break}}n[t]=a}}return n}function createExcelWorkbook(e,r){return _createExcelWorkbook.apply(this,arguments)}function _createExcelWorkbook(){return(_createExcelWorkbook=_asyncToGenerator(_regenerator().m(function e(r,n){var t,o,a,i,l,c,u,f,s,p,y,g,m,d,v,b;return _regenerator().w(function(e){for(;;)switch(e.n){case 0:for(t=new ExcelJS.Workbook,o=n.split(".")[0].substring(0,31),a=t.addWorksheet(o),i=r[0].length,l=0;l<r.length;l++)r[l].length<i?r[l].push(""):r[l].length>i&&(c=r[l].slice(0,i-1),u=r[l].slice(i-1).join(","),c.push(u),r[l]=c);for(f=getNumericColumns(r),s=[],p=0;p<i;p++)y={header:r[0][p],key:"".concat(p),width:15},f[p]&&(y.style={numFmt:"#,##0.00;[Red]-#,##0.00"}),s.push(y);for(a.columns=s,g=1;g<r.length;g++){for(m={},d=0;d<i;d++)m["".concat(d)]=r[g][d];a.addRow(m)}return a.getRow(1).font={bold:!0},a.eachRow(function(e,r){r>1&&e.eachCell(function(e,r){f[r-1]&&"number"==typeof e.value&&(e.numFmt="#,##0.00;[Red]-#,##0.00")})}),e.n=1,t.xlsx.writeBuffer();case 1:v=e.v,b=o+".xlsx",workbooksToSave.push({name:b,buffer:v,numericCols:f,headers:r[0]}),console.log("Workbook creato: ".concat(b));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function saveAllWorkbooks(){return _saveAllWorkbooks.apply(this,arguments)}function _saveAllWorkbooks(){return(_saveAllWorkbooks=_asyncToGenerator(_regenerator().m(function e(){var r,n,t,o,a,i,l,c,u,f;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,window.showDirectoryPicker();case 1:r=e.v,n=_createForOfIteratorHelper(workbooksToSave),e.p=2,n.s();case 3:if((t=n.n()).done){e.n=9;break}return o=t.value,a=o.name,i=o.buffer,o.numericCols,o.headers,e.n=4,r.getFileHandle(a,{create:!0});case 4:return l=e.v,e.n=5,l.createWritable();case 5:return c=e.v,e.n=6,c.write({type:"write",data:i});case 6:return e.n=7,c.close();case 7:console.log("Salvato: ".concat(a)),document.getElementById("fileName").textContent+="".concat(a," SALVATO CON SUCCESSO,   ");case 8:e.n=3;break;case 9:e.n=11;break;case 10:e.p=10,u=e.v,n.e(u);case 11:return e.p=11,n.f(),e.f(11);case 12:e.n=15;break;case 13:if(e.p=13,"AbortError"!==(f=e.v).name){e.n=14;break}console.log("Salvataggio annullato dall'utente"),alert("Salvataggio annullato"),e.n=15;break;case 14:throw f;case 15:return e.a(2)}},e,null,[[2,10,11,12],[0,13]])}))).apply(this,arguments)}Office.onReady(function(e){if(e.host===Office.HostType.Excel){document.getElementById("fileName").textContent="",document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",fileInput=document.getElementById("fileInput");var r=document.getElementById("run");fileInput.addEventListener("change",function(){if(fileInput.files&&fileInput.files.length>0&&(console.log("File selezionato:",fileInput.files[0].name),document.getElementById("fileName").textContent="Selected file: "+fileInput.files[0].name,fileInput.files.length>1))for(var e=1;e<fileInput.files.length;e++)document.getElementById("fileName").textContent+=", "+fileInput.files[e].name}),r.addEventListener("click",fileImport)}});